const { expect } = require('chai');
const vulnerabilityScanner = require('../src/services/vulnerabilityScanner');

describe('Vulnerability Scanner', () => {
  describe('Basic Scanning', () => {
    it('should perform a complete scan', async () => {
      const results = await vulnerabilityScanner.scan('https://example.com', 'full');
      expect(results).to.have.property('metadata');
      expect(results).to.have.property('summary');
      expect(results).to.have.property('details');
    });

    it('should include AI analysis in results', async () => {
      const results = await vulnerabilityScanner.scan('https://example.com', 'full');
      expect(results).to.have.property('aiAnalysis');
    });
  });

  describe('Vulnerability Checks', () => {
    it('should detect XSS vulnerabilities', async () => {
      const result = await vulnerabilityScanner.checkXSSVulnerability('https://example.com');
      expect(result).to.have.property('type', 'XSS');
      expect(result).to.have.property('severity');
      expect(result).to.have.property('description');
    });

    it('should detect SQL injection vulnerabilities', async () => {
      const result = await vulnerabilityScanner.checkSQLInjection('https://example.com');
      expect(result).to.have.property('type', 'SQL Injection');
      expect(result).to.have.property('severity');
      expect(result).to.have.property('description');
    });
  });

  describe('Security Headers', () => {
    it('should check security headers', async () => {
      const result = await vulnerabilityScanner.checkSecurityHeaders('https://example.com');
      expect(result).to.have.property('headers');
      expect(result).to.have.property('score');
    });
  });
}); 